@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h2>
    Dashboard</h2>
@*
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

*@
<div id="Dashboard" style="display: none;">
    <div class="DashboardSettingsHeader">
        Auto Refresh Rate: @Html.TextBox("txtRefreshRate", 5, new { @style = "width: 20px;", @required = "true", @maxLength = 2, @tooltip = "Values smaller than 4 will be ignored, no refresh!" })
        s
    </div>
    <div>
        <!-- Area 1-->
        <div id="UserFilter" class="LoadingConfiguration">
            <span>User Filter</span>
            @Html.TextBox("txtUserFilter", "janzi")
            @Html.TextBox("txtNumResults", 10, new { @style = "width: 20px;", @required = "true", @maxLength = 2 })
            <input type="button" title="refresh" value="Refresh" id="fetchUserFilter" />
            @*id="ExecutingRequstUserFilter"  *@
            <div class="LoadingIndicator">
                <img src="../../Images/ajax-loader.gif" alt="Loading"/> Loading ...
            </div>
        </div>
        <div id="UserFilterResult">
        </div>
    </div>
    <div>
        <!-- Recent changes-->

    </div>
</div>
@section scripts{
    <script src="../../Scripts/jQuery.tmpl.js" type="text/javascript"></script>
    <script type="text/javascript">
<!--
        url = "/Jira/UserOpenJiraIssues";
        intervallId = -1;
        $(document).ready(function () {
            $("#Dashboard").fadeIn("slow");
            $("input.#fetchUserFilter").click(FetchUserWithFilter);
        });


        // Used to filter on a specific user 
        function FetchUserWithFilter() {
            $("#UserFilter").fadeOut("fast");
            $("#UserFilter .LoadingIndicator").fadeIn("fast");
            window.clearInterval(intervallId);
            var load = url.replace("{0}", $("#txtUserFilter").val()).replace("{1}", $("#txtNumResults").val());
            $.getJSON(load, { username: $("#txtUserFilter").val(), numResults: $("#txtNumResults").val() }
                , function (data) {
                    //tmpl plugin http://msdn.microsoft.com/en-us/magazine/gg715549.aspx
                    var page = $("<div/>").addClass("IssueList"); //page-display
                    $("#tmplJiraIssue").tmpl(data.issues).appendTo($(page));
                    $("#UserFilterResult").empty().append($(page)).show("slow");
                }
            )
            .error(function () {
                $("#UserFilterResult").empty();
            })
            .always(function () {
                $("#UserFilter").fadeIn("fast");
                $("#UserFilter .LoadingIndicator").fadeOut("fast");

            });

            var timeout = Number($("#txtRefreshRate").val()) * 1000;
            if (timeout > 3000) {
                intervallId = window.setTimeout(FetchUserWithFilter, timeout);
            }
        }
        function FormatDate(jsonDate) {
            var value = new Date(jsonDate);
            //alert(value.toISOString("HH:mm DD.MM.YYYY"));
            return value.toLocaleString();  //value.getHours() + ":" + value.getMinutes() + " " + value.getDay() + "." + (value.getMonth()+1) + "." + value.getYear();
        }
//-->
    </script>
    <script id="tmplJiraIssue" type="text/html">
    <ul class="${fields.priority.name}">
        <li><a href="${self}"><input type="hidden" value="${id}"/> ${key}</a></li>
        <li><img src="${fields.issuetype.iconUrl}" alt="${fields.issuetype.name}" width="16px" height="16px"/></li>
        <li>${FormatDate(fields.created)}</li>
        <li>${fields.summary}</li>
    </ul>
    </script>
}
